<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ربات پولساز وحید - داشبورد سریع</title>
  <style>
    :root { --bg:#0e141b; --panel:#111a24; --brand:#00ff88; --muted:#9bb0c3; --warn:#ffb020; --bad:#ff5d5d; --good:#18c37e; }
    *{box-sizing:border-box} body{margin:0;background:linear-gradient(160deg,#0e141b,#0b1222);color:#e8f1f8;font-family:tahoma,iranyekan,system-ui,Segoe UI,Arial}
    header{padding:20px;text-align:center;border-bottom:1px solid #1d2a36;background:rgba(255,255,255,.02);backdrop-filter:blur(6px)}
    h1{margin:0;font-size:28px;color:var(--brand);text-shadow:0 0 18px rgba(0,255,136,.25)}
    .sub{color:var(--muted);margin-top:6px}
    .wrap{max-width:1200px;margin:0 auto;padding:20px}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:16px}
    .card{background:var(--panel);border:1px solid #1d2a36;border-radius:12px;padding:16px;box-shadow:0 6px 20px rgba(0,0,0,.25)}
    .title{font-weight:bold;margin-bottom:10px;color:#cfe6ff}
    .kpi{display:flex;justify-content:space-between;margin:8px 0;color:#dce7f1}
    .kpi .v{font-weight:bold}
    .bar{height:10px;background:#162433;border-radius:8px;overflow:hidden}
    .fill{height:100%;background:linear-gradient(90deg,var(--brand),#2adca1)}
    .status-good{color:var(--good)} .status-warn{color:var(--warn)} .status-bad{color:var(--bad)}
    footer{opacity:.6;text-align:center;padding:18px;color:#9bb0c3}
    .row{display:flex;gap:12px;flex-wrap:wrap}
    .pill{padding:6px 10px;border-radius:99px;background:#0d1c2a;border:1px solid #173043;color:#9ad1be}
  </style>
</head>
<body>
  <header>
    <h1>ربات پولساز وحید - داشبورد سریع</h1>
    <div class="sub">بهروز در لحظه • ساعت تهران: <span id="t3"></span></div>
  </header>

  <div class="wrap">
    <div class="grid">
      <div class="card">
        <div class="title">زمان و وضعیت</div>
        <div class="kpi"><span>Uptime</span><span class="v" id="uptime_h"></span></div>
        <div class="kpi"><span>شروع بهکار</span><span class="v" id="started_at"></span></div>
        <div class="row"><div class="pill" id="stamp"></div></div>
      </div>

      <div class="card">
        <div class="title">منابع سیستم</div>
        <div class="kpi"><span>CPU</span><span class="v" id="cpu"></span></div>
        <div class="bar"><div id="cpu_bar" class="fill" style="width:0%"></div></div>
        <div class="kpi"><span>RAM</span><span class="v" id="ram"></span></div>
        <div class="bar"><div id="ram_bar" class="fill" style="width:0%"></div></div>
        <div class="kpi"><span>Disk</span><span class="v" id="disk"></span></div>
        <div class="bar"><div id="disk_bar" class="fill" style="width:0%"></div></div>
      </div>

      <div class="card">
        <div class="title">وضعیت صرافی</div>
        <div class="kpi"><span>اتصال</span><span class="v" id="ex_conn">قطع</span></div>
        <div class="kpi"><span>صرافی</span><span class="v" id="ex_name">-</span></div>
        <div class="kpi"><span>موجودی USDT</span><span class="v" id="ex_bal">-</span></div>
        <div class="kpi"><span>نمادهای فعال</span><span class="v" id="ex_syms">0</span></div>
      </div>

      <div class="card">
        <div class="title">پیشرفت یادگیری</div>
        <div class="kpi"><span>وضعیت</span><span class="v" id="lg_active">غیرفعال</span></div>
        <div class="kpi"><span>پیشرفت</span><span class="v" id="lg_p">0%</span></div>
        <div class="bar"><div id="lg_bar" class="fill" style="width:0%"></div></div>
        <div class="kpi"><span>Workers</span><span class="v" id="lg_w">0</span></div>
        <div class="kpi"><span>آخرین بروزرسانی</span><span class="v" id="lg_t">-</span></div>
      </div>

      <div class="card">
        <div class="title">مانیتور اخبار</div>
        <div class="kpi"><span>وضعیت</span><span class="v" id="nw_active">غیرفعال</span></div>
        <div class="kpi"><span>Sentiment کریپتو</span><span class="v" id="nw_c">0.00</span></div>
        <div class="kpi"><span>Sentiment سهام</span><span class="v" id="nw_s">0.00</span></div>
        <div class="kpi"><span>اخبار تحلیلشده</span><span class="v" id="nw_n">0</span></div>
        <div class="kpi"><span>آخرین بروزرسانی</span><span class="v" id="nw_t">-</span></div>
      </div>
    </div>
  </div>

  <footer>ساخته شده برای سرعت و سادگی • نسخه بازنویسی شده</footer>

  <script>
    async function loadData() {
      try {
        const res = await fetch('/api/data', { cache: 'no-store' });
        const d = await res.json();

        document.getElementById('t3').textContent = d.tehran_time || '-';
        document.getElementById('stamp').textContent = d.timestamp?.replace('T',' ').slice(0,19) || '-';

        // uptime
        document.getElementById('uptime_h').textContent = d.uptime?.human || '-';
        document.getElementById('started_at').textContent = d.uptime?.started_at || '-';

        // system
        const cpu = d.system_resources?.cpu_percent || 0;
        const memp = d.system_resources?.memory?.percent || 0;
        const diskp = d.system_resources?.disk?.percent || 0;

        document.getElementById('cpu').textContent = cpu.toFixed(0) + '%';
        document.getElementById('ram').textContent = (memp).toFixed(0) + '% (' + (d.system_resources?.memory?.used || '-') + ' / ' + (d.system_resources?.memory?.total || '-') + ')';
        document.getElementById('disk').textContent = (diskp).toFixed(0) + '% (' + (d.system_resources?.disk?.used || '-') + ' / ' + (d.system_resources?.disk?.total || '-') + ')';

        document.getElementById('cpu_bar').style.width = Math.min(100, cpu) + '%';
        document.getElementById('ram_bar').style.width = Math.min(100, memp) + '%';
        document.getElementById('disk_bar').style.width = Math.min(100, diskp) + '%';

        // exchange
        const ex = d.exchange_status || {};
        document.getElementById('ex_conn').textContent = ex.connected ? 'متصل' : 'قطع';
        document.getElementById('ex_conn').className = 'v ' + (ex.connected ? 'status-good' : 'status-bad');
        document.getElementById('ex_name').textContent = ex.exchange || '-';
        document.getElementById('ex_bal').textContent = ex.balance_usdt != null ? ex.balance_usdt : '-';
        document.getElementById('ex_syms').textContent = ex.symbols_tracked || 0;

        // learning
        const lg = d.learning_progress || {};
        document.getElementById('lg_active').textContent = lg.active ? 'فعال' : 'غیرفعال';
        document.getElementById('lg_p').textContent = (lg.progress_percent || 0).toFixed(0) + '%';
        document.getElementById('lg_bar').style.width = Math.min(100, lg.progress_percent || 0) + '%';
        document.getElementById('lg_w').textContent = lg.workers || 0;
        document.getElementById('lg_t').textContent = lg.last_update || '-';

        // news
        const nw = d.news_status || {};
        document.getElementById('nw_active').textContent = nw.active ? 'فعال' : 'غیرفعال';
        document.getElementById('nw_c').textContent = (nw.crypto_sentiment || 0).toFixed(2);
        document.getElementById('nw_s').textContent = (nw.stock_sentiment || 0).toFixed(2);
        document.getElementById('nw_n').textContent = nw.news_analyzed || 0;
        document.getElementById('nw_t').textContent = nw.last_update || '-';
      } catch (e) {
        console.error('API error', e);
      }
    }
    loadData();
    setInterval(loadData, 5000);
  </script>
</body>
</html>